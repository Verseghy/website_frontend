<div class="controls">
  <div class="middle">
    <button class="next" (click)="prevMonth()">&lt;</button> <span class="month">{{ formatedDate | async }}</span>
    <button class="prev" (click)="nextMonth()">&gt;</button>
  </div>
  <button class="now" (click)="now()">{{ today }}</button>
</div>
<div class="grid" *ngIf="(cells | async) as cells">
  <div class="cellElement header" *ngFor="let item of shortDayNames">
    <span>{{ item }}</span>
  </div>
  <div
    #cellElement
    *ngFor="let cell of cells; trackBy: cellsTrackByFn"
    class="cellElement"
    [ngClass]="{ today: cell.today, anotherMonth: cell.anotherMonth }"
  >
    <span class="date">{{ cell.day }}</span>
    <div class="events">
      <div
        class="event"
        *ngFor="let event of cell.renderedEvents; trackBy: trackByFn"
        [ngStyle]="{ top: event.top, width: event.width, 'background-color': event.color }"
        [ngClass]="{ more: event.more }"
        (click)="setEventDetailsPopup(event.id, $event)"
      >
        <span>{{ event.title }}</span>
      </div>
      <div
        class="event more"
        *ngIf="cell.moreEventsVisible"
        [ngStyle]="{ top: cell.moreEventsTop }"
        (click)="setMoreEventsPopup(cell.date, cell.getEvents)"
      >
        <span>{{ cell.moreEventsText }}</span>
      </div>
    </div>
  </div>
</div>
<div class="popup" *ngIf="(moreEventsPopup | async) as details">
  <div
    class="more-events"
    #moreEventsPopup
    [ngStyle]="{ 'margin-top.px': details.top, 'margin-left.px': details.left }"
    *ngIf="details.visible"
    #moreEvents
  >
    <div class="header">
      <span class="day">{{ details.day }}</span>
      <h2 class="date">{{ details.date }}</h2>
      <span class="close" (click)="closeMoreEventsPopup()">x</span>
    </div>
    <div class="events">
      <div
        class="event popup-event"
        *ngFor="let event of (moreEventsPopupEvents | async)"
        [ngStyle]="{ 'background-color': event.color }"
        (click)="setEventDetailsPopup(event.id, $event)"
      >
        <span>{{ event.title }}</span>
      </div>
    </div>
  </div>
</div>
